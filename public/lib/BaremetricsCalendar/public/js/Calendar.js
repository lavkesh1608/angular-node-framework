!function(e,t){"function"==typeof define&&define.amd?define(["jquery","underscore","moment"],t):"object"==typeof exports?module.exports=t(require("jquery"),require("underscore"),require("moment")):e.Calendar=t(jQuery,_,moment)}(this,function(e,t,a){function s(t){var s=this;this.calIsOpen=!1,this.presetIsOpen=!1,this.element=t.element||e(".daterange"),this.type=this.element.hasClass("daterange--single")?"single":"double",this.selected=null,this.earliest_date=t.earliest_date||new Date("January 1, 1900"),this.latest_date=t.latest_date||new Date("December 31, 2900"),this.end_date=t.end_date||("double"==this.type?new Date:null),this.start_date=t.start_date||("double"==this.type?new Date(a(this.end_date).subtract(1,"month")):null),this.current_date=t.current_date||("single"==this.type?new Date:null),this.callback=t.callback||this.calendarSetDates,this.calendarHTML(this.type),e(".dr-presets",this.element).click(function(){s.presetToggle()}),e(".dr-list-item",this.element).click(function(){var t=e(".dr-item-aside",this).html().split("–");s.start_date=new Date(t[0]),s.end_date=new Date(t[1]),s.calendarSetDates(),s.presetToggle(),s.calendarSaveDates()}),e(".dr-date",this.element).on({click:function(){s.calendarOpen(this)},keyup:function(e){9!=e.keyCode||s.calIsOpen||s.start_date||s.end_date||s.calendarOpen(this)},keydown:function(t){if(13==t.keyCode&&(t.preventDefault(),s.calendarCheckDates(),s.calendarSetDates(),s.calendarSaveDates(),s.calendarClose("force")),27==t.keyCode&&(s.calendarSetDates(),s.calendarClose("force")),9==t.keyCode&&(e(s.selected).hasClass("dr-date-start")?(t.preventDefault(),e(".dr-date-end",s.element).trigger("click")):(s.calendarCheckDates(),s.calendarSaveDates(),s.calendarClose("force"))),38==t.keyCode){t.preventDefault();var d="day";t.shiftKey&&(d="week"),t.metaKey&&(d="month");var r=a(s.current_date).subtract(1,d);e(this).html(r.format("MMMM D, YYYY")),s.current_date=r._d}if(40==t.keyCode){t.preventDefault();var d="day";t.shiftKey&&(d="week"),t.metaKey&&(d="month");var i=a(s.current_date).add(1,d);e(this).html(i.format("MMMM D, YYYY")),s.current_date=i._d}}}),e(".dr-month-switcher i",this.element).click(function(){var t=e(".dr-month-switcher span",s.element).html(),d=e(".dr-year-switcher span",s.element).html(),r=a(new Date(t+" 1, "+d)).subtract(1,"month"),i=a(new Date(t+" 1, "+d)).add(1,"month").startOf("day");e(this).hasClass("dr-left")?(e(this).parent().find("span").html(r.format("MMMM")),s.calendarOpen(s.selected,r)):e(this).hasClass("dr-right")&&(e(this).parent().find("span").html(i.format("MMMM")),s.calendarOpen(s.selected,i))}),e(".dr-year-switcher i",this.element).click(function(){var t=e(".dr-month-switcher span",s.element).html(),d=e(".dr-year-switcher span",s.element).html(),r=a(new Date(t+" 1, "+d)).subtract(1,"year"),i=a(new Date(t+" 1, "+d)).add(1,"year").startOf("day");e(this).hasClass("dr-left")?(e(this).parent().find("span").html(r.format("YYYY")),s.calendarOpen(s.selected,r)):e(this).hasClass("dr-right")&&(e(this).parent().find("span").html(i.format("YYYY")),s.calendarOpen(s.selected,i))}),e(".dr-dates-dash",this.element).click(function(){e(".dr-date-start",s.element).trigger("click")}),e(this.element).click(function(t){e("html").one("click",function(){s.presetIsOpen&&s.presetToggle(),s.calIsOpen&&(s.calendarSetDates(),s.calendarClose("force"))}),t.stopPropagation()}),e(this.element).add(".dr-date",this.element).focus(function(t){e("html").one("click",function(){s.calIsOpen&&(s.calendarSetDates(),s.calendarClose("force"))}),t.stopPropagation()})}return s.prototype.presetToggle=function(){0==this.presetIsOpen?(this.presetIsOpen=!0,this.presetCreate()):this.presetIsOpen&&(this.presetIsOpen=!1),1==this.calIsOpen&&this.calendarClose(),e(".dr-preset-list",this.element).slideToggle(200),e(".dr-input",this.element).toggleClass("active"),e(".dr-presets",this.element).toggleClass("active")},s.prototype.presetCreate=function(){var t=this,s=this.latest_date,d=new Date(e(".dr-date-start",t.element).html()),r=new Date(e(".dr-date-end",t.element).html());this.start_date="Invalid Date"==d?this.start_date:d,this.end_date="Invalid Date"==r?this.end_date:r,e(".dr-list-item",this.element).each(function(){var d,r=e(this).data("months"),i=a(s).endOf("month").startOf("day"),n=i.isSame(s);return n||(i=a(s).subtract(1,"month").endOf("month").startOf("day")),"number"==typeof r?(d=a(s).subtract(n?r-1:r,"month").startOf("month"),12==r&&(d=a(s).subtract(n?12:13,"month").endOf("month").startOf("day"))):"all"==r?(d=a(t.earliest_date),i=a(t.latest_date)):(d=a(t.latest_date).subtract(30,"day"),i=a(t.latest_date)),d.isBefore(t.earliest_date)?e(this).remove():void e(".dr-item-aside",this).html(d.format("ll")+" – "+i.format("ll"))})},s.prototype.calendarSetDates=function(){if(e(".dr-date-start",this.element).html(a(this.start_date).format("MMMM D, YYYY")),e(".dr-date-end",this.element).html(a(this.end_date).format("MMMM D, YYYY")),!this.start_date&&!this.end_date){var t=e(".dr-date",this.element).html(),s=a(this.current_date).format("MMMM D, YYYY");t!=s&&e(".dr-date",this.element).html(s)}},s.prototype.calendarSaveDates=function(){return this.callback()},s.prototype.calendarCheckDates=function(){var t=/(?!<=\d)(st|nd|rd|th)/,s=e(".dr-date-start",this.element).html(),d=e(".dr-date-end",this.element).html(),r=e(this.selected).html(),i=[],n=[],l=[];return s&&(s=s.replace(t,""),i=s.split(" ")),d&&(d=d.replace(t,""),n=d.split(" ")),r&&(r=r.replace(t,""),l=r.split(" ")),2==i.length&&(i.push(a().format("YYYY")),s=i.join(" ")),2==n.length&&(n.push(a().format("YYYY")),d=n.join(" ")),2==l.length&&(l.push(a().format("YYYY")),r=l.join(" ")),s=new Date(s),d=new Date(d),r=new Date(r),a(s).isAfter(d)||a(d).isBefore(s)||a(s).isSame(d)||a(s).isBefore(this.earliest_date)||a(d).isAfter(this.latest_date)?this.calendarSetDates():(this.start_date="Invalid Date"==s?this.start_date:s,this.end_date="Invalid Date"==d?this.end_date:d,void(this.current_date="Invalid Date"==r?this.current_date:r))},s.prototype.calendarOpen=function(s,d){var r,i=this,n=e(".dr-dates",this.element).innerWidth()-8;this.selected=s||this.selected,1==this.presetIsOpen&&this.presetToggle(),1==this.calIsOpen&&this.calendarClose(d?"switcher":void 0),this.calendarCheckDates(),this.calendarCreate(d),this.calendarSetDates();var l=a(d||this.current_date).add(1,"month").startOf("month").startOf("day"),c=a(d||this.current_date).subtract(1,"month").endOf("month"),h=a(d||this.current_date).add(1,"year").startOf("month").startOf("day"),o=a(d||this.current_date).subtract(1,"year").endOf("month");e(".dr-month-switcher span",this.element).html(a(d||this.current_date).format("MMMM")),e(".dr-year-switcher span",this.element).html(a(d||this.current_date).format("YYYY")),e(".dr-switcher i",this.element).removeClass("dr-disabled"),l.isAfter(this.latest_date)&&e(".dr-month-switcher .dr-right",this.element).addClass("dr-disabled"),c.isBefore(this.earliest_date)&&e(".dr-month-switcher .dr-left",this.element).addClass("dr-disabled"),h.isAfter(this.latest_date)&&e(".dr-year-switcher .dr-right",this.element).addClass("dr-disabled"),o.isBefore(this.earliest_date)&&e(".dr-year-switcher .dr-left",this.element).addClass("dr-disabled"),e(".dr-day",this.element).on({mouseenter:function(){function s(s){r=void 0,e.each(t.range(42),function(t){var n=d.next().data("date"),l=d.prev().data("date"),c=d.data("date");return c?(l||(l=c),n||(n=c),"start"==s&&a(n).isSame(i.end_date)?!1:"end"==s&&a(l).isSame(i.start_date)?!1:"start"==s&&a(c).isAfter(i.end_date)&&(r=r||a(c).add(6,"day").startOf("day"),t>5||(n?a(n).isAfter(i.latest_date):!1))?(e(d).addClass("dr-end"),r=a(c),!1):"end"==s&&a(c).isBefore(i.start_date)&&(r=r||a(c).subtract(6,"day"),t>5||(l?a(l).isBefore(i.earliest_date):!1))?(e(d).addClass("dr-start"),r=a(c),!1):("start"==s&&(d=d.next().addClass("dr-maybe")),void("end"==s&&(d=d.prev().addClass("dr-maybe"))))):!1})}var d=e(this),n=a(i.start_date),l=a(i.end_date),c=a(i.current_date);n.isSame(c)&&(d.addClass("dr-hover dr-hover-before"),e(".dr-start",i.element).css({border:"none","padding-left":"0.3125rem"}),s("start")),l.isSame(c)&&(d.addClass("dr-hover dr-hover-after"),e(".dr-end",i.element).css({border:"none","padding-right":"0.3125rem"}),s("end")),i.start_date||i.end_date||d.addClass("dr-maybe"),e(".dr-selected",i.element).css("background-color","transparent")},mouseleave:function(){e(this).hasClass("dr-hover-before dr-end")&&e(this).removeClass("dr-end"),e(this).hasClass("dr-hover-after dr-start")&&e(this).removeClass("dr-start"),e(this).removeClass("dr-hover dr-hover-before dr-hover-after"),e(".dr-start, .dr-end",i.element).css({border:"",padding:""}),e(".dr-maybe:not(.dr-current)",i.element).removeClass("dr-start dr-end"),e(".dr-day",i.element).removeClass("dr-maybe"),e(".dr-selected",i.element).css("background-color","")},mousedown:function(){var t=e(this).data("date"),s=a(t).format("MMMM D, YYYY");r&&e(".dr-date",i.element).not(i.selected).html(r.format("MMMM D, YYYY")),e(i.selected).html(s),i.calendarOpen(i.selected),e(i.selected).hasClass("dr-date-start")?e(".dr-date-end",i.element).trigger("click"):(i.calendarSaveDates(),i.calendarClose("force"))}}),e(".dr-calendar",this.element).css("width",n).slideDown(200),e(".dr-input",this.element).addClass("active"),e(s).addClass("active").focus(),this.calIsOpen=!0},s.prototype.calendarClose=function(t){var a=this;return!this.calIsOpen||this.presetIsOpen||"force"==t?(e(".dr-date",this.element).blur(),e(".dr-calendar",this.element).slideUp(200,function(){e(".dr-day",a.element).remove()})):e(".dr-day",this.element).remove(),"switcher"==t?!1:(e(".dr-input, .dr-date",this.element).removeClass("active"),void(this.calIsOpen=!1))},s.prototype.calendarArray=function(e,s,d,r){var i=this,d=d||e||s,n=a(r||d).startOf("month"),l=a(r||d).endOf("month"),c={start:{day:+n.format("d"),str:+n.format("D")},end:{day:+l.format("d"),str:+l.format("D")}},h=void 0,o=t.map(t.range(c.start.day),function(){return void 0==h&&(h=a(n)),h=h.subtract(1,"day"),{str:+h.format("D"),start:h.isSame(e),end:h.isSame(s),current:h.isSame(d),selected:h.isBetween(e,s),date:h.toISOString(),outside:h.isBefore(i.earliest_date),fade:!0}}).reverse(),m=42-(c.end.str+o.length);h=void 0;var f=t.map(t.range(m),function(){return void 0==h&&(h=a(l)),h=h.add(1,"day").startOf("day"),{str:+h.format("D"),start:h.isSame(e),end:h.isSame(s),current:h.isSame(d),selected:h.isBetween(e,s),date:h.toISOString(),outside:h.isAfter(i.latest_date),fade:!0}});h=void 0;var p=t.map(t.range(c.end.str),function(){return h=void 0==h?a(n):h.add(1,"day").startOf("day"),{str:+h.format("D"),start:h.isSame(e),end:h.isSame(s),current:h.isSame(d),selected:h.isBetween(e,s),date:h.toISOString(),outside:h.isBefore(i.earliest_date)||h.isAfter(i.latest_date)}});return o.concat(p,f)},s.prototype.calendarCreate=function(a){var s=this,d=this.calendarArray(this.start_date,this.end_date,this.current_date,a);t.each(d,function(t,a){var d="dr-day";t.fade&&(d+=" dr-fade"),t.start&&(d+=" dr-start"),t.end&&(d+=" dr-end"),t.current&&(d+=" dr-current"),t.selected&&(d+=" dr-selected"),t.outside&&(d+=" dr-outside"),e(".dr-day-list",s.element).append('<li class="'+d+'" data-date="'+t.date+'">'+t.str+"</li>")})},s.prototype.calendarHTML=function(e){return this.element.append("double"==e?'<div class="dr-input"><div class="dr-dates"><div class="dr-date dr-date-start" contenteditable>'+a(this.start_date).format("MMMM D, YYYY")+'</div><span class="dr-dates-dash">–</span><div class="dr-date dr-date-end" contenteditable>'+a(this.end_date).format("MMMM D, YYYY")+'</div></div><div class="dr-presets"><span class="dr-preset-bar"></span><span class="dr-preset-bar"></span><span class="dr-preset-bar"></span></div></div><div class="dr-selections"><div class="dr-calendar" style="display: none;"><div class="dr-range-switcher"><div class="dr-switcher dr-month-switcher"><i class="dr-left"></i><span>April</span><i class="dr-right"></i></div><div class="dr-switcher dr-year-switcher"><i class="dr-left"></i><span>2015</span><i class="dr-right"></i></div></div><ul class="dr-days-of-week-list"><li class="dr-day-of-week">S</li><li class="dr-day-of-week">M</li><li class="dr-day-of-week">T</li><li class="dr-day-of-week">W</li><li class="dr-day-of-week">T</li><li class="dr-day-of-week">F</li><li class="dr-day-of-week">S</li></ul><ul class="dr-day-list"></ul></div><ul class="dr-preset-list" style="display: none;"><li class="dr-list-item" data-months="days">Last 30 days <span class="dr-item-aside"></span></li><li class="dr-list-item" data-months="1">Last month <span class="dr-item-aside"></span></li><li class="dr-list-item" data-months="3">Last 3 months <span class="dr-item-aside"></span></li><li class="dr-list-item" data-months="6">Last 6 months <span class="dr-item-aside"></span></li><li class="dr-list-item" data-months="12">Last year <span class="dr-item-aside"></span></li><li class="dr-list-item" data-months="all">All time <span class="dr-item-aside"></span></li></ul></div>':'<div class="dr-input"><div class="dr-dates"><div class="dr-date" contenteditable>'+a(this.current_date).format("MMMM D, YYYY")+'</div></div></div><div class="dr-selections"><div class="dr-calendar" style="display: none;"><div class="dr-range-switcher"><div class="dr-switcher dr-month-switcher"><i class="dr-left"></i><span></span><i class="dr-right"></i></div><div class="dr-switcher dr-year-switcher"><i class="dr-left"></i><span></span><i class="dr-right"></i></div></div><ul class="dr-days-of-week-list"><li class="dr-day-of-week">S</li><li class="dr-day-of-week">M</li><li class="dr-day-of-week">T</li><li class="dr-day-of-week">W</li><li class="dr-day-of-week">T</li><li class="dr-day-of-week">F</li><li class="dr-day-of-week">S</li></ul><ul class="dr-day-list"></ul></div></div>')},s});